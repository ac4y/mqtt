<!DOCTYPE html>
<html>
<head>
    <title>MQTT JavaScript Example</title>
</head>
<body>
    <h1>MQTT JavaScript Example</h1>
    <div>
        <label for="message">Message: </label>
        <input type="text" id="message" />
        <button onclick="publishMessage()">Send</button>
    </div>
    <div>
        <h3>Received Messages:</h3>
        <ul id="messages"></ul>
    </div>

    <script src="https://unpkg.com/paho-mqtt/mqttws31.js"></script>
    <script>
        // Connect to the MQTT broker
        const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "web-client-" + Math.random());

        // Define the callback for connection loss
        client.onConnectionLost = function (responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("Connection lost: " + responseObject.errorMessage);
            }
        };

        // Define the callback for incoming messages
        client.onMessageArrived = function (message) {
            const list = document.getElementById("messages");
            const listItem = document.createElement("li");
            listItem.textContent = `Topic: ${message.destinationName}, Message: ${message.payloadString}`;
            list.appendChild(listItem);
        };

        // Connect to the broker
        client.connect({
            onSuccess: function () {
                console.log("Connected to the broker!");
                // Subscribe to a topic
                client.subscribe("test/topic");
            },
            onFailure: function (error) {
                console.log("Connection failed: " + error.errorMessage);
            }
        });

        // Publish a message
        function publishMessage() {
            const messageInput = document.getElementById("message").value;
            if (messageInput) {
                const message = new Paho.MQTT.Message(messageInput);
                message.destinationName = "test/topic";
                client.send(message);
                console.log("Message sent: " + messageInput);
            }
        }
    </script>
</body>
</html>
